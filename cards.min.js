function getCardsJson(a){api_url="http://whateverorigin.org/get?url=",api_url+=encodeURIComponent(/^\d+$/.test(a)?"https://steamcommunity.com/profiles/"+a:"https://steamcommunity.com/id/"+a),api_url+=encodeURIComponent("/inventory/json/753/6?language=english"),$.ajax({url:api_url,dataType:"jsonp",success:function(a){try{cards_json=$.parseJSON(a.contents).rgDescriptions,count_json=$.parseJSON(a.contents).rgInventory}catch(e){return void $(".card-list").html("<h3>And error occurred! Is your Steam profile public? Did you type your Steam ID correctly?</h3>")}for(var t in count_json){var r=count_json[t].classid;count[r]?++count[r]:count[r]=1}for(var t in cards_json)if("tags"in cards_json[t]&&!(cards_json[t].tags.length<4)&&("item_class_2"==cards_json[t].tags[3].internal_name||"item_class_1"==cards_json[t].tags[3].internal_name))if(card={name:cards_json[t].name.replace(" (Trading Card)",""),game:cards_json[t].tags[1].name,icon_url:cards_json[t].icon_url,market_name:cards_json[t].market_name,market_hash_name:cards_json[t].market_hash_name,amount:count[cards_json[t].classid]},games[card.game])if(1===card.amount)games[card.game].push(card);else{var n=!0;for(var s in games[card.game])if(games[card.game][s].name===card.name){n=!1;break}n&&games[card.game].push(card)}else games[card.game]=[card];listGames()}})}function get_card(a,e,t,r){return'<div class="card-box"><div class="card-box-image"><img src="http://cdn.steamcommunity.com/economy/image/'+e+'"/></div><div class="card-box-text">'+a+(r>1?" x"+r:"")+'<br /><a target="blank" href="http://steamcommunity.com/market/listings/753/'+encodeURIComponent(t)+'">Steam market</a></div></div>'}function generateHTML(){html="";for(var a in games){html+="<h2>"+a+"</h2>";for(var e in games[a])card=games[a][e],html+=get_card(card.name,card.icon_url,card.market_hash_name,card.amount);html+='<div style="clear: both;"></div>'}return html}function generateDoubleHTML(){html="";for(var a in games){var e=!1;for(var t in games[a])card=games[a][t],card.amount>1&&(e||(html+="<h2>"+a+"</h2>",e=!0),html+=get_card(card.name,card.icon_url,card.market_hash_name,card.amount));html+='<div style="clear: both;"></div>'}return html}function generateRedditTable(){table="|Game|Cards\n|:-|:-:|";for(var a in games){table+="\n|"+a+"|";for(var e in games[a]){var t=games[a][e];table+=t.name+(t.amount>1?" x"+t.amount:"")+", "}table=table.substr(0,table.length-2)+"|"}return table}function listGames(){$(".card-list").html(generateHTML()),$("#reddit-table-button").fadeIn(),$("#show-doubles").fadeIn()}function listDoubleGames(){$(".card-list").html(generateDoubleHTML())}var count={},games={};$(function(){$("#steam-id-submit").click(function(){var a=$("#steam-id").val();return a.length>0?(count={},games={},$(".card-list").html('<img src="img/loading.gif" id="loading"/>'),$('[id^="reddit-table"]').hide(),getCardsJson(a)):$(".card-list").html('<div id="loading">Please input your Steam ID</div>'),!1}),$("#reddit-table-button").click(function(){return $("#reddit-table").html(generateRedditTable()),$("#reddit-table").fadeIn(),!1}),$("#show-doubles, #show-all").click(function(){return $(".card-list").html('<img src="img/loading.gif" id="loading"/>'),"show-doubles"==$(this).prop("id")?(listDoubleGames(),$(this).html("Show all").prop("id","show-all")):(listGames(),$(this).html("Show only doubles").prop("id","show-doubles")),!1})});
